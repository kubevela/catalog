# Deployment Workload

Similar to [OAM interacts with Kubernetes StatefulSet](https://github.com/oam-dev/catalog/tree/master/workloads/statefulset), this section will introduce how to use `Deployment`.

## Update RBAC for OAM ApplicationConfiguration
Please check the name and namespace of `ServiceAccount` you actually use in `rbac.yaml` before applying it.
```shell script
$ kubectl apply -f rbac.yaml
clusterrole.rbac.authorization.k8s.io/deployment-clusterrole-poc created
clusterrolebinding.rbac.authorization.k8s.io/component-deployment-workload-poc created
```



## Install Component

```shell script
$ kubectl apply -f sample-deployment-component.yaml
component.core.oam.dev/example-deployment created
```

## Run ApplicationConfiguration

```shell script
$ kubectl apply -f sample-applicationconfiguration.yaml
applicationconfiguration.core.oam.dev/example-deployment-appconfig created
```

Then you will see a Deployment app has been created.

```shell script
$ kubectl get deployment
NAME                             READY   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment                 1/1     1            1           50s
```

And one pod is generated by the deployment `nginx-deployment`.

```shell script
$ kubectl get pods
NAME                                READY   STATUS    RESTARTS   AGE
nginx-deployment-798dcc9989-zmf45   1/1     Running   0          91s


$ kubectl describe deployment nginx-deployment
Name:                   nginx-deployment
Namespace:              default
CreationTimestamp:      Thu, 04 Jun 2020 15:31:07 +0800
Labels:                 app=nginx
Annotations:            deployment.kubernetes.io/revision: 1
Selector:               app=nginx
Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=nginx
  Containers:
   nginx:
    Image:        nginx:1.17
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  <none>
    Mounts:       <none>
  Volumes:        <none>
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  <none>
NewReplicaSet:   nginx-deployment-798dcc9989 (1/1 replicas created)
Events:
  Type    Reason             Age    From                   Message
  ----    ------             ----   ----                   -------
  Normal  ScalingReplicaSet  2m46s  deployment-controller  Scaled up replica set nginx-deployment-798dcc9989 to 1
```

## About WorkloadDefinition

By applying `workloadDefinition.yaml`, WorkloadDefinition `deployments.apps` will be generated and you can see it from all CRDs of OAM.

```shell script
$ kubectl apply -f workloadDefinition.yaml
workloaddefinition.core.oam.dev/deployments.apps created

$ kubectl get oam
NAME                                                                  DEFINITION-NAME
workloaddefinition.core.oam.dev/containerizedworkloads.core.oam.dev   containerizedworkloads.core.oam.dev
workloaddefinition.core.oam.dev/deployments.apps                      deployments.apps

NAME                                        WORKLOAD-KIND
component.core.oam.dev/example-component    ContainerizedWorkload
component.core.oam.dev/example-deployment   Deployment

NAME                                                                 AGE
applicationconfiguration.core.oam.dev/example-deployment-appconfig   19m
```
